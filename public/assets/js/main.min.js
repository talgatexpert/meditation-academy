function fixHeaderPopup(){$(".js-header").hasClass("fixed")?(hideScroll(),$(".js-header").addClass("fixed-scroll")):hideScroll()}function hideScroll(){var e=document;e.body.classList.add("no-scroll"),e.scrollTop=window.pageYOffset,e.body.style.position="fixed",hasScrollbar()?e.body.style.width="calc(100% - "+getScrollbarSize()+"px)":e.body.style.width="100%",e.body.style.top=-e.scrollTop+"px"}function getScrollbarSize(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var s=document.createElement("div");s.style.width="100%",e.appendChild(s);var a=s.offsetWidth;return e.parentNode.removeChild(e),t-a}function hasScrollbar(){return document.body.scrollHeight>document.body.clientHeight}function showScroll(){var e=document;e.body.classList.remove("no-scroll"),e.body.style.position="",e.body.style.width="",e.body.style.top="",window.scroll(0,e.scrollTop),$(".js-header").removeClass("fixed-scroll")}$(function(){function e(e,t,s,a){return $.ajax({url:e,type:a,data:t,success:s})}svg4everybody(),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.extend({put:function(t,s,a){return e(t,s,a,"PUT")},delete:function(t,s,a){return e(t,s,a,"DELETE")}}),$(document).on("click",".js-ajax-reviews",function(e){e.preventDefault();let t=$(this),s=$(this).data("next-page");""!==s&&null!==s&&$.get(s).done(function(e){"OK"===e.status&&($(".js-ajax-reviews-load").append(e.reviews),t.data("next-page",e.next_page),null==e.next_page&&(t.data("next-page",""),t.hide()))}).fail(function(e){var t=$.parseJSON(e.responseText);alert(t.message?t.message:"Случилась непредвиденная ошибка.")})}),$(".js-subscribe").submit(function(e){e.preventDefault();let t=$(this).data("subscribe-url"),s=$(this).find("#email-subscribe").val();$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});let a=$(this).find("#email-subscribe");$.ajax({type:"POST",url:t,data:{email:s}}).done(function(e){a.val("")}).fail(function(e){var t=$.parseJSON(e.responseText);"ERROR"===t.status&&t.errors?(a.find(".field__input").removeClass("error"),a.find("label.error").remove(),$.each(t.errors,function(e,t){var s=s.addClass("error");$('<label class="error">'+t+"</label>").insertAfter(s)})):alert(t.message?t.message:"Случилась непредвиденная ошибка.")})}),$(".js-tag").on("click",function(e){e.preventDefault();var t=$(this).attr("href").substring(1);$('.js-article:not(".active")').fadeOut(0),$(this).hasClass("active")?($(this).removeClass("active"),$(".js-tag.active").length>0?$('.js-article[data-type="'+t+'"').removeClass("active").fadeOut(0):$(".js-article").removeClass("active").fadeIn()):($(this).addClass("active"),$('.js-article[data-type="'+t+'"').addClass("active").fadeIn(0))}),$(".js-hamb").on("click",function(){$(this).toggleClass("open"),$(".js-mobile-nav").toggleClass("open"),$(this).closest(".header").toggleClass("open"),$(this).hasClass("open")?fixHeaderPopup():showScroll()}),$('input[type="checkbox"], input[type="radio"]').styler(),$(document).on("change","input, textarea",function(){$(this).val()?$(this).addClass("value"):$(this).removeClass("value")}),$(".js-gallery-slider").owlCarousel({items:1,nav:!0,dots:!0,dotsEach:!0,loop:!0,margin:50,smartSpeed:550,autoplay:!1}),$(".js-classes-slider").owlCarousel({items:1,nav:!0,dots:!0,dotsEach:!0,loop:!0,margin:50,smartSpeed:550,autoplay:!1}),$(".js-team-slider").owlCarousel({items:1,nav:!0,dots:!0,dotsEach:!0,loop:!0,margin:100,smartSpeed:550,autoplay:!1}),$(".js-reviews-slider").owlCarousel({items:1,nav:!0,dots:!0,dotsEach:!0,loop:!0,margin:50,smartSpeed:550,autoplay:!1}),$(".js-interview-slider").owlCarousel({items:1,nav:!0,dots:!0,dotsEach:!0,loop:!0,margin:50,smartSpeed:550,autoplay:!1}),$(".js-valid").each(function(){$(this).validate({submitHandler:function(e){return!1}})}),$(".js-popup-ajax form").each(function(){var e=$(this);e.on("submit",function(t){t.preventDefault();var s=e.find("button[type=submit]");s.prop("disabled",!0),$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serialize()}).done(function(t){s.prop("disabled",!1),"OK"===t.status?t.redirect?window.location.replace(t.redirect):(e.parent(".js-popup").removeClass("open"),$("#popup-message .popup__title").html(t.popup.title),$("#popup-message .popup__text").html(t.popup.text),$(".popup-bg, #popup-message").addClass("open")):alert(t.message?t.message:"Случилась непредвиденная ошибка.")}).fail(function(t){s.prop("disabled",!1);var a=$.parseJSON(t.responseText);"ERROR"===a.status&&a.errors?(e.find(".field__input").removeClass("error"),e.find("label.error").remove(),$.each(a.errors,function(t,s){var a=e.find("input[name="+t+"]").addClass("error");$('<label class="error">'+s+"</label>").insertAfter(a)})):alert(a.message?a.message:"Случилась непредвиденная ошибка.")})}),e.on("reset",function(){e.find(".field__input").removeClass("error value"),e.find("label.error").remove()})}),$("#reasons .js-poll").click(function(e){e.preventDefault();var t=$(this);"yes"!==localStorage.getItem("poll-reasons")?$.post(t.closest(".reasons").data("poll-url"),{name:t.data("poll-name"),options:[t.data("poll-option")]}).always(function(e){"OK"===e.status&&localStorage.setItem("poll-reasons","yes"),window.location.href=t.attr("href")}):window.location.href=t.attr("href")});var t="";$(".js-change-avatar").on("click",function(){$(this).fadeOut(0),$(".js-avatars-dropdown").fadeIn(),t=$(".js-current-avatar img").attr("src")}),$(".js-avatars a").on("click",function(){var e=$(this).children("img").attr("src");$(".js-current-avatar img").attr("src",e)}),$(".js-save-avatar").on("click",function(){$(".js-current-avatar img").attr("src");$(".js-change-avatar").fadeIn(),$(".js-avatars-dropdown").fadeOut(0)}),$(".js-user-update").on("submit",function(e){e.preventDefault();let t=$(this),a=t.find(".js-current-avatar img").attr("src"),o=t.data("user-update-url"),r=t.find(".js-user-name").val(),n=t.find(".js-comment-visible"),i=n.is(":checked");$.post({url:o,data:{image:a,name:r,comment:i}}).done(function(e){"OK"===e.status&&($(".letters").length>0&&($(".letters").children().remove(),$(".letters").append(e.content),s.checkbox=e.visible,s.img=e.img,t.find(".js-comment-visible").prop("checked",e.visible),e.visible?n.addClass("checked"):n.addClass("remove")),$(".popup-bg, .js-popup").removeClass("open"),$(".js-popup-bg").removeClass("open"),$(".js-profile div").text(e.name),showScroll(),$(".js-change-avatar").fadeIn(),$(".js-avatars-dropdown").fadeOut(0))}).fail(function(e){var s=$.parseJSON(e.responseText);if("ERROR"===s.status&&s.errors)return t.find(".field__input").removeClass("error"),t.find("label.error").remove(),$.each(s.errors,function(e,s){var a=t.find("input[name="+e+"]").addClass("error");$('<label class="error">'+s+"</label>").insertAfter(a)}),hideScroll(),!1})}),$(".js-cancel-avatar").on("click",function(){$(".js-change-avatar").fadeIn(),$(".js-avatars-dropdown").fadeOut(0),$(".js-current-avatar img").attr("src",t)}),$(".js-registration").on("click",function(){$("#popup-registration form").trigger("reset"),$(".popup-bg, #popup-registration").addClass("open"),fixHeaderPopup()}),$(".js-profile").on("click",function(){$(".popup-bg, .js-popup-profile").addClass("open"),fixHeaderPopup()}),$(".js-call").on("click",function(){$("#popup-callback form").trigger("reset"),$(".popup-bg, #popup-callback").addClass("open"),fixHeaderPopup()}),$(document).on("click",".js-curator-comment-reply",function(e){e.preventDefault(),$(this).closest(".comment__info").find(".comment-curator-reply-form").toggle()});let s={checkbox:$(".js-comment-visible").is("checked"),img:$(".js-current-avatar img").attr("src")};function a(e){var t=$(document).scrollTop();$(".js-anchors a").each(function(){var e=$(this),s=$(e.attr("href")),a=s.position().top;if(s.hasClass("section--white")&&(a-=200),a<=t&&a+s.height()>t){$(".js-anchors a").removeClass("active"),e.addClass("active");var o=$(".js-anchors a.active").attr("href");$(".screen").removeClass("active"),$(o).addClass("active")}})}$(".js-popup-bg").on("click",function(e){if($(e.target).closest(".js-popup").length)return;let t=$(".js-comment-visible"),a=$(".js-user-update").find(".js-user-name");$.get("/participant-get",function(e){"OK"===e.status&&(s.checkbox=e.visible,!0===s.checkbox?(t.prop("checked",!0),t.addClass("checked")):(t.prop("checked",!1),t.removeClass("checked")),a.val(e.name),a.addClass("value"))}),$(".js-current-avatar img").attr("src",s.img),$(".popup-bg, .js-popup").removeClass("open"),$(".js-user-update input").removeClass("error"),$(".js-user-update label.error").remove(),$(".js-change-avatar").fadeIn(),$(".js-avatars-dropdown").fadeOut(0),showScroll(),e.stopPropagation()}),$(".js-popup-close").on("click",function(){let e=$(".js-comment-visible"),t=$(".js-user-update").find(".js-user-name");$.get("/participant-get",function(a){"OK"===a.status&&(s.checkbox=a.visible,!0===s.checkbox?(e.prop("checked",!0),e.addClass("checked")):(e.prop("checked",!1),e.removeClass("checked")),t.val(a.name),t.addClass("value"))}),$(".js-user-update input").removeClass("error"),$(".js-user-update label.error").remove(),$(".js-change-avatar").fadeIn(),$(".js-avatars-dropdown").fadeOut(0),$(".js-current-avatar img").attr("src",s.img),showScroll(),$(".popup-bg, .js-popup").removeClass("open")}),$(window).scrollTop()>50&&$(".js-header").addClass("fixed"),$(window).on("scroll",function(){$(window).scrollTop()>50?$(".js-header").addClass("fixed"):$(".js-header").removeClass("fixed")}),$(".js-reason").on("click",function(){$(window).width()<768?($(".js-reason").not(this).find(".reason-info").slideUp(),$(this).find(".reason-info").slideDown()):($(".js-reason").removeClass("open").not(this).fadeTo(200,.3),$(this).addClass("open"))}),$(".js-reason").on("mouseenter",function(){$(".js-reason").not(this).fadeTo(200,.3),$(this).fadeTo(200,1)}),$(document).on("click",".js-accordion-link",function(){if($(this).toggleClass("open"),$(this).closest(".js-accordion").toggleClass("open").find(".js-accordion-drop").slideToggle(),$(this).hasClass("open")&&$(this).hasClass("item-letter__link"))$(this).find("span").text("Скрыть письмо");else{$(this).find("span").text("Показать письмо");var e=$(this).closest(".js-accordion").offset().top-$(".js-header").outerHeight();$("html, body").animate({scrollTop:e},"300")}}),$(document).on("click",".item-letter__link",function(){var e=$(this).closest(".letters__item");e.hasClass("new")&&$.ajax({type:"PATCH",url:e.data("read-url")}).done(function(t){if("OK"===t.status){if(e.removeClass("new"),e.find(".item-letter__status").remove(),t.hasOwnProperty("new_messages")){var s=$(".header__user .user__number");t.new_messages>0?s.html(t.new_messages):s.remove()}}else alert(t.message?t.message:"Случилась непредвиденная ошибка.")}).fail(function(e){var t=$.parseJSON(e.responseText);alert(t.message?t.message:"Случилась непредвиденная ошибка.")})}),$("[data-fancybox]").fancybox({afterShow:function(e,t){var s=t.$slide.find(this.src);s[0].play(),s.on("ended",function(){$.fancybox.close()})}}),$(".js-result").on("click",function(){$(this).toggleClass("open"),$(".js-result-hidden").fadeToggle()}),$(document).on("scroll",a),$(".js-anchors a").on("click",function(e){e.preventDefault(),$(document).off("scroll");var t=$(this).attr("href");$(".js-anchors a").removeClass("active"),$(t).addClass("active"),$(this).addClass("active");var s=this.hash;$target=$(s),scrollTop=0,$(t).hasClass("section--white")?scrollTop=$target.offset().top-200:scrollTop=$target.offset().top+2,$("html, body").stop().animate({scrollTop:scrollTop},500,"swing",function(){$(document).on("scroll",a)})}),$(window).scroll(function(){$(window).scrollTop()>715?$(".js-up").addClass("show"):$(".js-up").removeClass("show")}),$(".js-up").on("click",function(e){e.preventDefault(),$("html, body").animate({scrollTop:0},"300")});var o=$("#audio-player").get(0);$(".step-info__audio .audio__btn").click(function(){o.paused?(o.play(),$(this).addClass("play")):(o.pause(),$(this).removeClass("play"))}),$(o).bind("timeupdate",function(){var e=Math.floor(this.currentTime/60);e=e>=10?e:"0"+e;var t=Math.floor(this.currentTime%60);t=t>=10?t:"0"+t,$(".step-info__audio .audio__current-time").text(e+":"+t),$(".step-info__audio .audio__progress").css("width",100*this.currentTime/this.duration+"%"),this.currentTime>=this.duration&&$(".step-info__audio .audio__btn").removeClass("play")}),$(".step-info__audio .audio__progress").click(function(e){var t=(e.pageX-$(this).offset().left)/$(this).outerWidth()*100;o.currentTime=t*o.duration/100}),$(document).on("submit","form.report-form",function(e){e.preventDefault();var t=$(this);const s=e=>{var s=t.find("button[type=submit]");const a=t.serialize()+e;console.log(a),s.prop("disabled",!0),$.ajax({type:t.attr("method"),url:t.attr("action"),data:a}).done(function(e){s.prop("disabled",!1),"OK"===e.status?(t.remove(),$(".item-step__comments").data("last-id",e.lastId),$(".comments__amount").text(e.reportsCount),$(".comments__items").html(e.comments),$(".comments__more").css("display",e.showMore?"inline-flex":"none")):alert(e.message?e.message:"Случилась непредвиденная ошибка.")}).fail(function(e){s.prop("disabled",!1);var a=$.parseJSON(e.responseText);if("ERROR"===a.status&&a.errors){var o=t.find(".field__textarea").addClass("error");t.find("label.error").remove(),$('<label class="error">'+a.errors[Object.keys(a.errors)[0]]+"</label>").insertAfter(o)}else alert(a.message?a.message:"Случилась непредвиденная ошибка.")})};OneSignal.push(function(){OneSignal.isPushNotificationsEnabled(function(e){e?OneSignal.getUserId().then(e=>{s(e)}):OneSignal.showNativePrompt().then(()=>{OneSignal.getUserId().then(e=>{s(e)})})})})}),$(".comments__more").click(function(){var e=$(".item-step__comments");$.get(e.data("load-url"),{id:e.data("last-id"),step:e.data("step")}).done(function(t){"OK"===t.status?(e.data("last-id",t.lastId),$(".comments__amount").text(t.reportsCount),$(".comments__items").append(t.comments),$(".comments__more").css("display",t.showMore?"inline-flex":"none")):alert(t.message?t.message:"Случилась непредвиденная ошибка.")}).fail(function(e){var t=$.parseJSON(e.responseText);alert(t.message?t.message:"Случилась непредвиденная ошибка.")})});var r=null;$(".item-step__comments").on("click","a.comment-reply",function(){var e=$(this).closest(".comments__item"),t=e.find(".comment-reply-form form"),s=e.data("comment-id");let a=$(this);n&&($(".comment-edit-form").hide(),$(".comment-edit-form .field__textarea").val("").removeClass("error value"),$(".comment-edit-form label.error").remove(),n=null),r?s===r?(t.find(".field__textarea").val("").removeClass("error value"),t.find("label.error").remove(),t.parent().hide(),r=null):($(".comment-reply-form").hide(),$(".comment-reply-form .field__textarea").val("").removeClass("error value"),$(".comment-reply-form label.error").remove(),t.parent().show(),r=s):(t.parent().show(),r=s),t.unbind("submit").submit(function(e){e.preventDefault();var s=t.find("button[type=submit]");s.prop("disabled",!0),$.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serialize()}).done(function(e){s.prop("disabled",!1),"OK"===e.status?(0===$(".comments__items").find("#report-"+e.reportId+"-comments").children().length?($("#report-"+e.reportId+"-comments").append(e.comment),a.closest(".comment").find(".comment-delete").remove(),a.closest(".comment").find(".comment-edit").remove()):$(".comments__items").find("#report-"+e.reportId+"-comments").length>0?$("#report-"+e.reportId+"-comments").append(e.comment):a.closest(".comment-block").append(e.comment),t.find(".field__textarea").val("").removeClass("error value"),t.find("label.error").remove(),t.parent().hide(),r=null):alert(e.message?e.message:"Случилась непредвиденная ошибка.")}).fail(function(e){s.prop("disabled",!1);var a=$.parseJSON(e.responseText);if("ERROR"===a.status&&a.errors){var o=t.find(".field__textarea").addClass("error");t.find("label.error").remove(),$('<label class="error">'+a.errors[Object.keys(a.errors)[0]]+"</label>").insertAfter(o)}else alert(a.message?a.message:"Случилась непредвиденная ошибка.")})})}),$(document).on("submit",".comment-curator-reply-form form",function(e){e.preventDefault();let t=$(this);var s=t.find("button[type=submit]");s.prop("disabled",!0),$.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serialize()}).done(function(e){t.unbind("submit"),s.prop("disabled",!1),"OK"===e.status?(0!==$("#report-"+e.reportId+"-comments").length?$("#report-"+e.reportId+"-comments").append(e.comment):$("[data-comment-id="+e.reportId+"]").after(e.comment),t.parent().hide(),t.find("textarea").val("").text("")):alert(e.message?e.message:"Случилась непредвиденная ошибка.")}).fail(function(e){s.prop("disabled",!1);var a=$.parseJSON(e.responseText);if("ERROR"===a.status&&a.errors){var o=t.find(".field__textarea").addClass("error");t.find("label.error").remove(),$('<label class="error">'+a.errors[Object.keys(a.errors)[0]]+"</label>").insertAfter(o)}else alert(a.message?a.message:"Случилась непредвиденная ошибка.")})});var n=null;$(".item-step__comments").on("click","a.comment-edit",function(){var e=$(this).closest(".comments__item"),t=e.find(".comment-edit-form form"),s=t.find(".field__textarea"),a=e.data("comment-id");r&&($(".comment-reply-form").hide(),$(".comment-reply-form .field__textarea").val("").removeClass("error value"),$(".comment-reply-form label.error").remove(),r=null),n?a===n?(t.find(".field__textarea").val("").removeClass("error value"),t.find("label.error").remove(),t.parent().hide(),n=null):($(".comment-edit-form").hide(),$(".comment-edit-form .field__textarea").val("").removeClass("error value"),$(".comment-edit-form label.error").remove(),s.val(e.find(".comment__text p").html()).addClass("value"),t.parent().show(),n=a):(s.val(e.find(".comment__text p").text()).addClass("value"),t.parent().show(),n=a),t.unbind("submit").submit(function(a){a.preventDefault();var o=t.find("button[type=submit]");o.prop("disabled",!0),$.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serialize()}).done(function(s){o.prop("disabled",!1),"OK"===s.status?(e.replaceWith(s.comment),t.find(".field__textarea").val("").removeClass("error value"),t.find("label.error").remove(),t.parent().hide(),n=null):alert(s.message?s.message:"Случилась непредвиденная ошибка.")}).fail(function(e){o.prop("disabled",!1);var a=$.parseJSON(e.responseText);"ERROR"===a.status&&a.errors?(s.addClass("error"),t.find("label.error").remove(),$('<label class="error">'+a.errors[Object.keys(a.errors)[0]]+"</label>").insertAfter(s)):alert(a.message?a.message:"Случилась непредвиденная ошибка.")})})}),$(document).on("click",".item-step__comments a.comment-delete",function(e){e.preventDefault();var t=$(this).closest(".comments__item");t.closest(".comments__items");let s=$(this).closest(".comment-block").data("child-comment-id"),a=$(this).closest(".comments__items").find("[data-comment-id="+s+"]");confirm("Вы действительно хотите удалить свой комментарий?")&&$.delete(t.data("delete-url")).done(function(e){if("OK"===e.status){if(t.remove(),"step-7-gratitude"===window.location.href.split("/")[3])window.location.reload();else{let t=a.find(".comment__bottom"),s='<div class="comment__icons"><a class="comment__icon comment-edit" href="javascript:void(0);" title="Редактировать свой комментарий">\n                        <svg class="icon icon-edit"><use xlink:href="/assets/img/spritesvg.svg#edit"></use></svg>\n                    </a><a class="comment__icon comment-delete" href="javascript:void(0);" title="Удалить свой комментарий">\n                        <svg class="icon icon-delete"><use xlink:href="/assets/img/spritesvg.svg#delete"></use></svg>\n                    </a></div>';if($("#report-"+a.data("comment-id")+"-comments").children().length<=0){t.append(s);let e=$("[data-load-url]").data("loadUrl");a.attr("data-delete-url",e+"/"+a.data("comment-id"))}$(".comments__amount").text(e.reportsCount);let o='<form action="'+$(".comments").data("store-url")+'" method="POST"  class="step-info__form form report-form"><div class="form__field field field--wide"><textarea class="field__textarea" name="body" required maxlength="2000"></textarea><div class="field__label">Ваш отчет</div>\n</div><input type="hidden" name="one_signal" id="oneSignalClientId" value=""><button type="submit" class="form__btn btn" onclick="return startPusher()"><span>Отправить отчет</span></button></form>';0===$(".report-form").length&&0===$("[data-comment-id="+a.data("comment-id")+"]").length&&$(".js-form-report").append(o)}}else alert(e.message?e.message:"Случилась непредвиденная ошибка.")}).fail(function(e){var t=$.parseJSON(e.responseText);alert(t.message?t.message:"Случилась непредвиденная ошибка.")})}),$(".item-step__comments").on("click","a.js-like",function(){var e=$(".item-step__comments"),t=$(this).closest(".comments__item"),s=$(this);$.post(e.data("like-url"),{comment_id:t.data("comment-id")}).done(function(e){"OK"===e.status?(s.toggleClass("active",e.active),s.find("span").text(e.total)):alert(e.message?e.message:"Случилась непредвиденная ошибка.")}).fail(function(e){var t=$.parseJSON(e.responseText);"ERROR"===t.status&&t.errors?alert(t.errors[Object.keys(t.errors)[0]]):alert(t.message?t.message:"Случилась непредвиденная ошибка.")})}),"comment"===window.location.hash.substr(1,7)&&($('a[name="'+window.location.hash.substr(1)+'"]').length||$("html, body").animate({scrollTop:$("a.comments__more").offset().top-100},500));var i=$("form.questionare");i.submit(function(e){e.preventDefault();var t=$('input[type="checkbox"]:checked',i).map(function(){return $(this).data("poll-option")}).get();t.length&&$.post(i.data("poll-url"),{name:i.data("poll-name"),options:t}).done(function(e){"OK"===e.status?(i.find(".questionare__title").html("Спасибо, что помогаете нам <br>стать лучше!"),i.find(".questionare__group").remove(),i.find(".questionare__btn").remove()):alert(e.message?e.message:"Случилась непредвиденная ошибка.")}).fail(function(e){var t=$.parseJSON(e.responseText);alert(t.message?t.message:"Случилась непредвиденная ошибка.")})}),i.find(".questionare__btn").click(function(e){e.preventDefault(),i.submit()})});
